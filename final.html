<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dora Campaign Intake</title>
  <style>
    :root{
      --bg:#fff5eaff;
      --panel:#ffffffff;
      --text:#570000;
      --muted:#444444;
      --accent:#0b57d0;
      --danger:#c62828;
      --ok:#2e7d32;
      --border:#570000ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:var(--bg);
      color:var(--text);
    }
    .container{max-width:1100px;margin:0 auto;padding:24px}
    h1{font-size:28px;margin:0 0 8px}
    p.lead{margin:0 0 24px;color:var(--muted)}
    form{display:grid;gap:14px}
    fieldset{border:1px solid var(--border);border-radius:14px;padding:16px;background:var(--panel)}
    legend{padding:0 8px;color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .row-1{display:grid;grid-template-columns:1fr;gap:12px}
    label{display:block;font-weight:600;margin-bottom:6px}
    .desc{font-weight:500;color:var(--muted);font-size:13px;margin-top:4px}
    input[type="text"], input[type="date"], input[type="search"], select, textarea{
      width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;color:var(--text)
    }
    textarea{min-height:100px;resize:vertical}
    .hint{font-size:12px;color:var(--muted)}
    .required::after{content:" *";color:var(--danger);font-weight:700}
    .note{background:#fff;border-left:3px solid var(--accent);padding:10px 12px;border-radius:10px;color:var(--muted)}
    .error{color:var(--danger);font-size:13px;margin-top:6px;display:none}
    .hidden{display:none !important}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    button{appearance:none;border:1px solid var(--border);background:#ffffff;color:var(--text);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    button.primary{background:linear-gradient(135deg,#cc0001,#cc0001);border:none;color:#fff}
    button.ghost{background:transparent}
    .output{white-space:pre-wrap;background:#fff;border:1px dashed #cfcfcf;border-radius:12px;padding:14px;min-height:120px}
    .copy-section {margin-top: 10px;text-align: center;}
    .support-msg{color:var(--danger);font-weight:600}
  </style>
</head>
<body>
  <div class="container">
    <h1>Dora Prompt Generator</h1>
    <p class="lead">Building for marketing channels? Fill out this form to generate a complete, ready-to-use prompt. Fields will update as you go.</p>

    <form id="intakeForm" novalidate>
      <!-- Audience -->
      <fieldset>
        <legend>Audience</legend>
        <div class="row">
          <div>
            <label for="audience" class="required">What audience are you building your campaign for?</label>
            <select id="audience" required>
              <option value="" selected disabled>Select audience</option>
              <option>Consumer</option>
              <option>Dasher</option>
              <option>B2B</option>
            </select>
            <div class="error" id="audienceErr">Audience is required.</div>
          </div>
        </div>
      </fieldset>

      <!-- CONSUMER -->
      <fieldset id="consumerBlock" class="hidden">
        <legend>Consumer Campaign Details</legend>
        <div class="row">
          <div>
            <label for="channel" class="required">For which channel is your asset?</label>
            <select id="channel" required>
              <option value="" selected disabled>Select channel</option>
              <option>Email</option>
              <option>Push Notification</option>
              <option>Paid Media</option>
              <option>Long-form Content</option>
              <option>In-app Merchandising</option>
            </select>
            <div class="error" id="channelErr">Channel is required.</div>
          </div>
        </div>
        <div id="unsupportedMsg" class="note hidden">
          <span class="support-msg">Dora does not currently support these channels.</span>
        </div>

        <!-- Email/Push only -->
        <div id="epBlock" class="hidden">
          <div class="row">
            <div>
              <label for="segment" class="required">What is your Audience Segment?</label>
              <select id="segment" required>
                <option value="" selected disabled>Select segment</option>
                <option>Active Consumer</option>
                <option>Churned Consumer</option>
                <option>DashPass Member</option>
                <option>Dormant Consumer</option>
                <option>New Consumer</option>
              </select>
              <div class="error" id="segmentErr">Audience Segment is required.</div>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="behavior" class="required">What has this user done or not done recently? What’s their current mindset or situation?</label>
              <textarea id="behavior" placeholder="Start with &quot;who…?&quot; e.g., who haven’t ordered in 30 days and are craving convenience" required></textarea>
              <div class="hint">Please start your response with "who".</div>
              <div class="error" id="behaviorErr">This field is required and must start with "who".</div>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="submarkets" class="required">Is this asset specific to a specific set of submarkets?</label>
              <textarea id="submarkets" placeholder="e.g., Phoenix, Denver, Minneapolis" required></textarea>
              <div class="error" id="submarketsErr">This field is required.</div>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="usecase" class="required">What is your use case?</label>
              <select id="usecase" required>
                <option value="" selected disabled>Select use case</option>
                <option>Convert New Customers</option>
                <option>Reactivate Dormant Users</option>
                <option>Apology/Trust Recovery</option>
                <option>Promote New Feature, Service, Mx</option>
                <option>Drive Promo Redemptions</option>
                <option>Non-monetary engagement</option>
                <option>Other</option>
              </select>
              <div class="error" id="usecaseErr">Use case is required.</div>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="action" class="required">What action do you want the consumer to take?</label>
              <textarea id="action" placeholder="What do you want them to do? Briefly expand on the CTA." required></textarea>
              <div class="error" id="actionErr">This field is required.</div>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="takeaway" class="required">What is the most important takeaway for the consumer?</label>
              <textarea id="takeaway" placeholder="What's the one thing you want them to remember? Is there a claim or value prop to substantiate it?" required></textarea>
              <div class="error" id="takeawayErr">This field is required.</div>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="feature">Can you provide more details or context about the feature or service you’d like to highlight?</label>
              <textarea id="feature" placeholder="e.g., Snap EBT on grocery, DoubleDash, saved addresses"></textarea>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="lob">What line of business is this focused on?</label>
              <select id="lob">
                <option value="" selected disabled>Select line of business</option>
                <option>Restaurant</option>
                <option>Grocery &amp; Convenience</option>
                <option>Retail</option>
                <option>Alcohol</option>
                <option>N/A</option>
              </select>
            </div>
            <div>
              <label for="cta">What is your primary CTA?</label>
              <div id="c_ctaHint" class="hint hidden">
    (Note: for Meta ads, CTA buttons are predetermined through the Meta UI. Work with your channel manager to determine which one is best.)
  </div>
              <select id="cta">
                <option value="" selected disabled>Select CTA</option>
                <option>Order now</option>
                <option>Get DashPass</option>
                <option>Sign up</option>
                <option>Upgrade now</option>
                <option>Activate now</option>
                <option>Shop now</option>
                <option>Order drinks</option>
                <option>Shop gifts</option>
                <option>See deals</option>
              </select>
            </div>
          </div>

          <!-- Paid Media (Consumer) -->
          <fieldset id="paidBlock" class="hidden">
            <legend>Paid Media</legend>

            <div class="row">
              <div>
                <label for="adPlatforms" class="required">What platform is your ad running on?</label>
                <select id="adPlatforms" multiple size="6">
                  <option>Meta ad</option>
                  <option>Snap ad</option>
                  <option>TikTok ad</option>
                  <option>YouTube Short ad</option>
                  <option>Google Demand Gen/Display ad</option>
                  <option>All paid channels</option>
                </select>
                <div class="hint">Hold Cmd/Ctrl to select more than one.</div>
                <div class="error" id="adPlatformsErr">Select at least one platform.</div>
              </div>
            </div>

            <div id="adTypeWrap" class="row hidden">
              <div>
                <label for="adType" class="required">What type of ad are you running?</label>
                <select id="adType">
                  <option value="" selected disabled>Select ad type</option>
                  <option>Static</option>
                  <option>Video</option>
                  <option>Static and Video</option>
                </select>
                <div class="error" id="adTypeErr">Ad type is required.</div>
              </div>
            </div>
            <div id="videoQWrap" class="row hidden">
              <div>
                <label for="videoLength" class="required">How long is your video?</label>
                <select id="videoLength">
                  <option value="" selected disabled>Select length</option>
                  <option>:06</option>
                  <option>:10</option>
                  <option>:15</option>
                  <option>:30</option>
                </select>
                <div class="error" id="videoLengthErr">Video length is required.</div>
              </div>
            </div>
          </fieldset>

          <!-- Promotion toggle (Consumer) -->
          <fieldset>
            <legend>Promotion</legend>
            <div class="row">
              <div>
                <label for="hasPromo">Is there a promotion tied to your campaign?</label>
                <select id="hasPromo">
                  <option>No</option>
                  <option>Yes</option>
                </select>
              </div>
            </div>

            <div id="promoBlock" class="hidden">
              <div class="row">
                <div>
                  <label for="promoType" class="required">What is your primary promo deal</label>
                  <select id="promoType">
                    <option value="" selected disabled>Select promo type</option>
                    <option>X Off Your Order</option>
                    <option>Save Up To $X</option>
                    <option>$0 Delivery Fee</option>
                    <option>$ X off Delivery Fee</option>
                    <option>Other</option>
                  </select>
                  <div class="error" id="promoTypeErr">Promo Type is required.</div>
                </div>
                <div>
                  <label for="discount" class="required">What is the discount? Must include $ or %</label>
                  <input id="discount" type="text" placeholder="$10 or 20%" />
                  <div class="error" id="discountErr">Include $ or % (e.g., $10 or 20%).</div>
                </div>
              </div>

              <div class="row-3">
                <div>
                  <label for="startDate" class="required">Start date (mm/dd/yy)</label>
                  <input id="startDate" type="text" placeholder="mm/dd/yy" />
                  <div class="error" id="startErr">Use mm/dd/yy.</div>
                </div>
                <div>
                  <label for="endDate" class="required">End date (mm/dd/yy)</label>
                  <input id="endDate" type="text" placeholder="mm/dd/yy" />
                  <div class="error" id="endErr">Use mm/dd/yy.</div>
                </div>
                <div>
                  <label for="minSubtotal" class="required">Minimum subtotal (0 if none)</label>
                  <input id="minSubtotal" type="text" placeholder="e.g., 20 or 0" />
                  <div class="error" id="minErr">Enter a non-negative number.</div>
                </div>
              </div>

              <div class="row">
                <div>
                  <label for="maxDiscount" class="required">Max discount (0 if none)</label>
                  <input id="maxDiscount" type="text" placeholder="e.g., 25 or 0" />
                  <div class="error" id="maxErr">Enter a non-negative number.</div>
                </div>
                <div>
                  <label for="pickupOnly">Is this promotion for pickup orders only?</label>
                  <select id="pickupOnly">
                    <option>No</option>
                    <option>Yes</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div>
                  <label for="promoCode">What is the promotion code? (n/a if none)</label>
                  <input id="promoCode" type="text" placeholder="e.g., SAVE10 or n/a" />
                </div>
                <div>
                  <label for="dashpassOnly">Is this promotion for DashPass members only?</label>
                  <select id="dashpassOnly">
                    <option>No</option>
                    <option>Yes</option>
                  </select>
                </div>
              </div>
            </div>
          </fieldset>

          <!-- Secondary module (Consumer) -->
          <fieldset id="c_secondaryFS">
            <legend>Secondary Module</legend>
            <div class="row">
              <div>
                <label for="hasSecondary">Does your asset need a secondary module?</label>
                <select id="hasSecondary">
                  <option>No</option>
                  <option>Yes</option>
                </select>
                <p class="subtext">
                  Add a secondary module if you’re featuring multiple categories or adding necessary context. 
                  Keep the message clear, scannable, and distinct from the lead.
                </p>
              </div>
            </div>

            <div id="secondaryBlock" class="hidden">
              <div class="row">
                <div>
                  <label for="secondaryObjective">Provide the message objective of this secondary module</label>
                  <textarea id="secondaryObjective" placeholder="What value prop, product offering, or feature supports that action?"></textarea>
                </div>
              </div>
              <div class="row">
                <div>
                  <label for="secondaryLOB">What line of business is this focused on?</label>
                  <select id="secondaryLOB">
                    <option value="" selected disabled>Select line of business</option>
                    <option>Restaurant</option>
                    <option>Grocery &amp; Convenience</option>
                    <option>Retail</option>
                    <option>Alcohol</option>
                    <option>N/A</option>
                  </select>
                </div>
                <div>
                  <label for="secondaryCTA">What is your CTA for this secondary module</label>
                  <select id="secondaryCTA">
                    <option value="" selected disabled>Select CTA</option>
                    <option>Order now</option>
                    <option>Get DashPass</option>
                    <option>Sign up</option>
                    <option>Upgrade now</option>
                    <option>Activate now</option>
                    <option>Shop now</option>
                    <option>Order drinks</option>
                    <option>Shop gifts</option>
                    <option>See deals</option>
                  </select>
                </div>
              </div>
            </div>
          </fieldset>
        </div>
      </fieldset>

      <!-- DASHER -->
      <fieldset id="dasherBlock" class="hidden">
        <legend>Dasher Campaign Details</legend>
        <div class="row">
          <div>
            <label for="d_channel" class="required">What channel is your asset?</label>
            <select id="d_channel" required>
              <option value="" selected disabled>Select channel</option>
              <option>Email</option>
              <option>Push Notification</option>
              <option>Paid Media</option>
              <option>Long-form Content</option>
              <option>In-app Merchandising</option>
            </select><div id="d_unsupportedMsg" class="note hidden">
  <span class="support-msg">Dora does not currently support these channels.</span>
</div>
            <div class="error" id="d_channelErr">Channel is required.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="d_segment" class="required">What is your Audience Segment?</label>
            <select id="d_segment" required>
              <option value="" selected disabled>Select segment</option>
              <option>Active Dasher</option> 
              <option>ANFD Dasher</option>
              <option>Churned Dasher</option>
              <option>New Dasher</option>
            </select>
            <div class="error" id="d_segmentErr">Audience Segment is required.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="d_behavior" class="required">What has this Dasher done or not done recently? What’s their current mindset or situation?</label>
            <textarea id="d_behavior" placeholder="Start with &quot;who…?&quot;" required></textarea>
            <div class="hint">Please start your response with "who".</div>
            <div class="error" id="d_behaviorErr">This field is required and must start with "who".</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="d_submarkets">Is this asset specific to a specific set of submarkets?</label>
            <textarea id="d_submarkets" placeholder="e.g., Phoenix, Denver, Minneapolis"></textarea>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="d_usecase" class="required">What is your use case?</label>
            <select id="d_usecase" required>
              <option value="" selected disabled>Select use case</option>
              <option>First Dash Conversion (New Dx)</option>
              <option>Churn/Reactivation</option>
              <option>Promotions: Challenge/Streak/Boost</option>
              <option>Apology/Outage</option>
              <option>New Feature/Order Type</option>
              <option>Education/Retention</option>
              <option>Programs: Rewards/Crimson</option>
              <option>Other</option>
            </select>
            <div class="error" id="d_usecaseErr">Use Case is required.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="d_action" class="required">What action do you want the Dasher to take?</label>
            <textarea id="d_action" placeholder="What do you want them to do? Briefly expand on the CTA." required></textarea>
            <div class="error" id="d_actionErr">This field is required.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="d_takeaway" class="required">What is the most important takeaway for the Dasher?</label>
            <textarea id="d_takeaway" placeholder="What's the one thing you want them to remember? Is there a claim or value prop to substantiate it?" required></textarea>
            <div class="error" id="d_takeawayErr">This field is required.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="d_feature">Can you provide more details or context about the feature or service you’d like to highlight?</label>
            <textarea id="d_feature"></textarea>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="d_cta">What is your primary CTA?</label>
            <div id="d_ctaHint" class="hint hidden">
    (Note: for Meta ads, CTA buttons are predetermined through the Meta UI. Work with your channel manager to determine which one is best.)
  </div>
            <select id="d_cta">
              <option value="" selected disabled>Select CTA</option>
              <option>Dash now</option>
              <option>Download now</option>
              <option>Get started</option>
              <option>Learn more</option>
              <option>Activate now</option>
              <option>See deals</option>
              <option>Sign up</option>
            </select>
          </div>
        </div>

        <!-- Paid Media (Dasher) -->
        <fieldset id="d_paidBlock" class="hidden">
          <legend>Paid Media</legend>

          <div class="row">
            <div>
              <label for="d_adPlatforms" class="required">What platform is your ad running on?</label>
              <select id="d_adPlatforms" multiple size="6">
                <option>Meta ad</option>
                <option>Snap ad</option>
                <option>TikTok ad</option>
                <option>YouTube Short ad</option>
                <option>Google Demand Gen/Display ad</option>
                <option>All paid channels</option>
              </select>
              <div class="hint">Hold Cmd/Ctrl to select more than one.</div>
              <div class="error" id="d_adPlatformsErr">Select at least one platform.</div>
            </div>
          </div>

          <div id="d_adTypeWrap" class="row hidden">
            <div>
              <label for="d_adType" class="required">What type of ad are you running?</label>
              <select id="d_adType">
                <option value="" selected disabled>Select ad type</option>
                <option>Static</option>
                <option>Video</option>
                <option>Static and Video</option>
              </select>
              <div class="error" id="d_adTypeErr">Ad type is required.</div>
            </div>
          </div>
          <div id="d_videoQWrap" class="row hidden">
            <div>
              <label for="d_videoLength" class="required">How long is your video?</label>
              <select id="d_videoLength">
                <option value="" selected disabled>Select length</option>
                <option>:06</option>
                <option>:10</option>
                <option>:15</option>
                <option>:30</option>
              </select>
              <div class="error" id="d_videoLengthErr">Video length is required.</div>
            </div>
          </div>
        </fieldset>

        <!-- Promotion (Dasher) -->
        <fieldset>
          <legend>Promotion</legend>
          <div class="row">
            <div>
              <label for="d_hasPromo">Is there a promotion tied to your campaign?</label>
              <select id="d_hasPromo">
                <option>No</option>
                <option>Yes</option>
              </select>
            </div>
          </div>

          <div id="d_promoBlock" class="hidden">
            <div class="row">
              <div>
                <label for="d_promoType" class="required">What is your primary promotion?</label>
                <select id="d_promoType">
                  <option value="" selected disabled>Select promotion</option>
                  <option>Complete x dashers, receive $x</option>
                  <option>streaks</option>
                  <option>other</option>
                </select>
                <div class="error" id="d_promoTypeErr">Promotion type is required.</div>
              </div>
              <div id="d_otherWrap" class="hidden">
                <label for="d_otherPromo">If other, describe</label>
                <input id="d_otherPromo" type="text" placeholder="Describe your promotion" />
              </div>
            </div>

            <div class="row-3">
              <div>
                <label for="d_startDate" class="required">Start date (mm/dd/yy)</label>
                <input id="d_startDate" type="text" placeholder="mm/dd/yy" />
                <div class="error" id="d_startErr">Use mm/dd/yy.</div>
              </div>
              <div>
                <label for="d_endDate" class="required">End date (mm/dd/yy)</label>
                <input id="d_endDate" type="text" placeholder="mm/dd/yy" />
                <div class="error" id="d_endErr">Use mm/dd/yy.</div>
              </div>
              <div>
                <label for="d_minDeliveries" class="required">Minimum Deliveries (0 if none)</label>
                <input id="d_minDeliveries" type="text" placeholder="e.g., 10 or 0" />
                <div class="error" id="d_minErr">Enter a non-negative number.</div>
              </div>
            </div>

            <div class="row">
              <div>
                <label for="d_stdPayout" class="required">Standard Payout (must include $)</label>
                <input id="d_stdPayout" type="text" placeholder="$50" />
                <div class="error" id="d_stdErr">Must include $ (e.g., $50).</div>
              </div>
              <div>
                <label for="d_maxPayout" class="required">Max Payout (N/A if not applicable; must include $)</label>
                <input id="d_maxPayout" type="text" placeholder="$100 or N/A" />
                <div class="error" id="d_maxErr">Include $ or write N/A.</div>
              </div>
            </div>

            <div id="d_streaksBlock" class="hidden">
              <div class="row">
                <div>
                  <label for="d_consecDays" class="required">How many consecutive days are required to earn the payout?</label>
                  <input id="d_consecDays" type="text" placeholder="e.g., 3" />
                  <div class="error" id="d_daysErr">Enter a non-negative number.</div>
                </div>
                <div>
                  <label for="d_additionalPayout" class="required">Additional payout amount if more than minimum consecutive days</label>
                  <input id="d_additionalPayout" type="text" placeholder="$20" />
                  <div class="error" id="d_additionalErr">Must include $ (e.g., $20).</div>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <!-- Secondary module (Dasher) -->
        <fieldset id="d_secondaryFS">
          <legend>Secondary Module</legend>
          <div class="row">
            <div>
              <label for="d_hasSecondary">Does your asset need a secondary module?</label>
              <select id="d_hasSecondary">
                <option>No</option>
                <option>Yes</option>
              </select>
              <p class="subtext">
                Add a secondary module if you’re featuring multiple categories or adding necessary context. 
                Keep the message clear, scannable, and distinct from the lead.
              </p>
            </div>
          </div>

          <div id="d_secondaryBlock" class="hidden">
            <div class="row">
              <div>
                <label for="d_secondaryObjective">Provide the message objective of this secondary module</label>
                <textarea id="d_secondaryObjective" placeholder="What do you want them to do? Briefly expand on the CTA."></textarea>
              </div>
            </div>
            <div class="row">
              <div>
                <label for="d_secondaryLOB">What line of business is this focused on?</label>
                <select id="d_secondaryLOB">
                  <option value="" selected disabled>Select line of business</option>
                  <option>Restaurant</option>
                  <option>Grocery &amp; Convenience</option>
                  <option>Retail</option>
                  <option>Alcohol</option>
                  <option>N/A</option>
                </select>
              </div>
              <div>
                <label for="d_secondaryCTA">What is your CTA for this secondary module</label>
                <select id="d_secondaryCTA">
                  <option value="" selected disabled>Select CTA</option>
                  <option>Dash now</option>
                  <option>Get Download now</option>
                  <option>Get started</option>
                  <option>Learn more</option>
                  <option>Activate now</option>
                  <option>See deals</option>
                  <option>Sign up</option>
                </select>
              </div>
            </div>
          </div>
        </fieldset>
      </fieldset>

      <!-- MERCHANT -->
      <fieldset id="merchantBlock" class="hidden">
        <legend>B2B Campaign Details</legend>

        <div class="row">
          <div>
            <label for="m_channel" class="required">What channel is your asset?</label>
            <select id="m_channel" required>
              <option value="" selected disabled>Select channel</option>
              <option>Email</option>
              <option>Push Notification</option>
              <option>Paid Media</option>
              <option>Long-form Content</option>
              <option>Merchant Portal Feed Card</option>
            </select>
            <div class="error" id="m_channelErr">Channel is required.</div>
          </div><div id="m_unsupportedMsg" class="note hidden">
  <span class="support-msg">Dora does not currently support this channel.</span>
</div>
        </div>
        <!-- MERCHANT Long-Form Content -->
<div id="m_longform" class="hidden">
  <div class="row">
    <div>
      <label for="m_longType" class="required">What type of long form content are you creating?</label>
      <select id="m_longType">
        <option value="" selected disabled>Select content type</option>
        <option>Blog Post</option>
        <option>Success Story / Case Study</option>
        <option>SEO Landing Page</option>
      </select>
      <div class="error" id="m_longTypeErr">Content type is required.</div>
    </div>
  </div>

  <!-- Success Story / Case Study fields -->
  <div id="m_successFields" class="hidden">
    <div class="row">
      <div>
        <label for="m_successMerchant" class="required">Please provide details about Merchant</label>
        <textarea id="m_successMerchant"></textarea>
        <div class="error" id="m_successMerchantErr">This field is required.</div>
      </div>
    </div>
    <div class="row">
      <div>
        <label for="m_successQuotes" class="required">Please provide key quotes from your Merchant for your success story.</label>
        <textarea id="m_successQuotes"></textarea>
        <div class="error" id="m_successQuotesErr">This field is required.</div>
      </div>
    </div>
    <div class="row">
      <div>
        <label for="m_successResults" class="required">Please provide key performance results from your merchants.</label>
        <textarea id="m_successResults"></textarea>
        <div class="error" id="m_successResultsErr">This field is required.</div>
      </div>
    </div>
  </div>

  <!-- SEO Landing Page fields -->
  <div id="m_seoFields" class="hidden">
    <div class="row">
      <div>
        <label for="m_seoKeywords" class="required">What are your SEO keywords for your landing pages?</label>
        <textarea id="m_seoKeywords"></textarea>
        <div class="error" id="m_seoKeywordsErr">This field is required.</div>
      </div>
    </div>
    </div> <!-- end m_seoFields -->
</div> <!-- end m_longform -->
  


        <div class="row">
          <div>
            <label for="m_segment" class="required">What is your Audience Segment?</label>
            <select id="m_segment" required>
              <option value="" selected disabled>Select segment</option>
              <option>New to DoorDash</option> 
              <option>Active on DoorDash</option>
              <option>Prospective </option>
            </select>
            <div class="error" id="m_segmentErr">Audience Segment is required.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="m_behavior" class="required">What has this audience done or not done recently? What’s their current mindset or situation?</label>
            <textarea id="m_behavior" placeholder="Start with &quot;who…?&quot;" required></textarea>
            <div class="hint">Please start your response with "who".</div>
            <div class="error" id="m_behaviorErr">This field is required and must start with "who".</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="m_usecase" class="required">What is your use case?</label>
            <select id="m_usecase" required>
              <option value="" selected disabled>Select use case</option>
              <option>Onboarding</option>
              <option>New Product / Product Upsell</option>
              <option>Transactional</option>
              <option>Apology / Outage</option>
              <option>Occasions and Co-Marketing</option>
              <option>Educational / Informational</option>
              <option>Prospective</option>
              <option>Other</option>
            </select>
            <div class="error" id="m_usecaseErr">Use Case is required.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="m_action" class="required">What action do you want the audience to take?</label>
            <textarea id="m_action" placeholder="What do you want them to do? Briefly expand on the CTA." required></textarea>
            <div class="error" id="m_actionErr">This field is required.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="m_takeaway" class="required">What is the most important takeaway for the audience?</label>
            <textarea id="m_takeaway" placeholder="What's the one thing you want them to remember? Is there a claim or value prop to substantiate it?" required></textarea>
            <div class="error" id="m_takeawayErr">This field is required.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="m_feature">Can you provide more details or context about the feature or service you’d like to highlight?</label>
            <textarea id="m_feature" placeholder="Description of your product or service. Focus on what it is in simple language."></textarea>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="m_cta">What is your primary CTA?</label>
            <div id="m_ctaHint" class="hint hidden">
    (Note: for Meta ads, CTA buttons are predetermined through the Meta UI. Work with your channel manager to determine which one is best.)
  </div>
            <select id="m_cta">
              <option value="" selected disabled>Select CTA</option>
              <option>Get started</option>
              <option>Sign up</option>
              <option>Explore products</option>
              <option>Learn more</option>
            </select>
          </div>
        </div>

        <!-- Paid Media  (Merchant) -->
        <fieldset id="m_paidBlock" class="hidden">
          <legend>Paid Media</legend>
          <div class="row">
            <div>
              <label for="m_adPlatforms" class="required">What platform is your ad running on?</label>
              <select id="m_adPlatforms" multiple size="6">
                <option>Meta ad</option>
                <option>LinkedIn ad</option>
                <option>Google Display ad</option>
                <option>YouTube ad</option>
                <option>All paid channels</option>
              </select>
              <div class="hint">Hold Cmd/Ctrl to select more than one.</div>
              <div class="error" id="m_adPlatformsErr">Select at least one platform.</div>
            </div>
          </div>

          <div id="m_adTypeWrap" class="row hidden">
            <div>
              <label for="m_adType" class="required">What type of ad are you running?</label>
              <select id="m_adType">
                <option value="" selected disabled>Select ad type</option>
                <option>Static</option>
                <option>Video</option>
                <option>Static and Video</option>
              </select>
              <div class="error" id="m_adTypeErr">Ad type is required.</div>
            </div>
          </div>
          <div id="m_videoQWrap" class="row hidden">
            <div>
              <label for="m_videoLength" class="required">How long is your video?</label>
              <select id="m_videoLength">
                <option value="" selected disabled>Select length</option>
                <option>:06</option>
                <option>:10</option>
                <option>:15</option>
                <option>:30</option>
              </select>
              <div class="error" id="m_videoLengthErr">Video length is required.</div>
            </div>
          </div>
        </fieldset>

        <!-- Secondary module (Merchant) -->
        <fieldset id="m_secondaryFS">
          <legend>Secondary Module</legend>
          <div class="row">
            <div>
              <label for="m_hasSecondary">Does your asset need a secondary module?</label>
              <select id="m_hasSecondary">
                <option>No</option>
                <option>Yes</option>
              </select>
              <p class="subtext">Add a secondary module if you’re featuring multiple categories or adding necessary context.</p>
            </div>
          </div>

          <div id="m_secondaryBlock" class="hidden">
            <div class="row">
              <div>
                <label for="m_secondaryObjective">Provide the message objective of this secondary module</label>
                <textarea id="m_secondaryObjective" placeholder="What value prop, product offering, or feature supports that action?"></textarea>
              </div>
            </div>
            <div class="row">
              <div>
                <label for="m_secondaryCTA">What is your CTA for this secondary module</label>
                <select id="m_secondaryCTA">
                  <option value="" selected disabled>Select CTA</option>
                  <option>Get started</option>
              <option>Sign up</option>
              <option>Explore products</option>
              <option>Learn more</option>
                </select>
              </div>
            </div>
          </div>
        </fieldset>
      </fieldset>

      <!-- Actions -->
      <div class="actions">
        <button type="button" class="primary" id="generateBtn">Generate Response</button>
        <button type="reset" class="ghost" id="resetBtn">Reset</button>
      </div>

      <!-- Generated Output -->
      <div id="formErr" class="note hidden" role="alert" aria-live="polite">
  <span class="support-msg">Please complete the required fields to generate your prompt</span>
</div>
      <fieldset>
        <legend>Generated Response</legend>
        <div id="output" class="output" aria-live="polite"></div>
        <div class="copy-section">
          <button type="button" id="copyBtn">Copy Text</button>
        </div>
      </fieldset>

    </form>


    <script>
      const el = (id) => document.getElementById(id);

      // Shared
      const audience = el('audience');
      const output = el('output');
      const copyBtn = el('copyBtn');
      const generateBtn = el('generateBtn');
      const resetBtn = el('resetBtn');
      const formErr = el('formErr');


      // Consumer refs
      const consumerBlock = el('consumerBlock');
      const channel = el('channel');
      const unsupportedMsg = el('unsupportedMsg');
      const epBlock = el('epBlock');

      const segment = el('segment');
      const behavior = el('behavior');
      const submarkets = el('submarkets');
      const usecase = el('usecase');
      const action = el('action');
      const takeaway = el('takeaway');
      const feature = el('feature');
      const lob = el('lob');
      const cta = el('cta');
      const c_ctaHint = el('c_ctaHint');

      const paidBlock = el('paidBlock');
      const adPlatforms = el('adPlatforms');
      const adTypeWrap = el('adTypeWrap');
      const adType = el('adType');
      const videoQWrap = el('videoQWrap');
      const videoLength = el('videoLength');

      const hasPromo = el('hasPromo');
      const promoBlock = el('promoBlock');
      const promoType = el('promoType');
      const discount = el('discount');
      const startDate = el('startDate');
      const endDate = el('endDate');
      const minSubtotal = el('minSubtotal');
      const maxDiscount = el('maxDiscount');
      const pickupOnly = el('pickupOnly');
      const promoCode = el('promoCode');
      const dashpassOnly = el('dashpassOnly');

      const c_secondaryFS = el('c_secondaryFS');
      const hasSecondary = el('hasSecondary');
      const secondaryBlock = el('secondaryBlock');
      const secondaryObjective = el('secondaryObjective');
      const secondaryLOB = el('secondaryLOB');
      const secondaryCTA = el('secondaryCTA');

      // Dasher refs
      const dasherBlock = el('dasherBlock');
      const d_channel = el('d_channel');
      const d_unsupportedMsg = el('d_unsupportedMsg');
      const d_segment = el('d_segment');
      const d_behavior = el('d_behavior');
      const d_submarkets = el('d_submarkets');
      const d_usecase = el('d_usecase');
      const d_action = el('d_action');
      const d_takeaway = el('d_takeaway');
      const d_feature = el('d_feature');
      const d_cta = el('d_cta');
      const d_ctaHint = el('d_ctaHint');
      
      const d_paidBlock = el('d_paidBlock');
      const d_adPlatforms = el('d_adPlatforms');
      const d_adTypeWrap = el('d_adTypeWrap');
      const d_adType = el('d_adType');
      const d_videoQWrap = el('d_videoQWrap');
      const d_videoLength = el('d_videoLength');

      const d_hasPromo = el('d_hasPromo');
      const d_promoBlock = el('d_promoBlock');
      const d_promoType = el('d_promoType');
      const d_otherWrap = el('d_otherWrap');
      const d_otherPromo = el('d_otherPromo');
      const d_startDate = el('d_startDate');
      const d_endDate = el('d_endDate');
      const d_minDeliveries = el('d_minDeliveries');
      const d_stdPayout = el('d_stdPayout');
      const d_maxPayout = el('d_maxPayout');
      const d_streaksBlock = el('d_streaksBlock');
      const d_consecDays = el('d_consecDays');
      const d_additionalPayout = el('d_additionalPayout');
      
      const d_secondaryFS = el('d_secondaryFS');
      const d_hasSecondary = el('d_hasSecondary');
      const d_secondaryBlock = el('d_secondaryBlock');
      const d_secondaryObjective = el('d_secondaryObjective');
      const d_secondaryLOB = el('d_secondaryLOB');
      const d_secondaryCTA = el('d_secondaryCTA');

      // Merchant refs
      const merchantBlock = el('merchantBlock');
      const m_channel = el('m_channel');
      const m_segment = el('m_segment');
      const m_behavior = el('m_behavior');
      const m_usecase = el('m_usecase');
      const m_action = el('m_action');
      const m_takeaway = el('m_takeaway');
      const m_feature = el('m_feature');
      const m_cta = el('m_cta');
      const m_ctaHint = el('m_ctaHint');
      const m_unsupportedMsg = el('m_unsupportedMsg');

      const m_longform = el('m_longform');
const m_longType = el('m_longType');
const m_successFields = el('m_successFields');
const m_successMerchant = el('m_successMerchant');
const m_successQuotes = el('m_successQuotes');
const m_successResults = el('m_successResults');
const m_seoFields = el('m_seoFields');
const m_seoKeywords = el('m_seoKeywords');

      
      const m_paidBlock = el('m_paidBlock');
      const m_adPlatforms = el('m_adPlatforms');
      const m_adTypeWrap = el('m_adTypeWrap');
      const m_adType = el('m_adType');
      const m_videoQWrap = el('m_videoQWrap');
      const m_videoLength = el('m_videoLength');

      const m_secondaryFS = el('m_secondaryFS');
      const m_hasSecondary = el('m_hasSecondary');
      const m_secondaryBlock = el('m_secondaryBlock');
      const m_secondaryObjective = el('m_secondaryObjective');
      const m_secondaryCTA = el('m_secondaryCTA');

      // Validation helpers
      const reDate = /^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{2}$/; // mm/dd/yy
      const reMoneyNum = /^\d+(?:\.\d{1,2})?$/;

      function showError(id, show) {
        const e = el(id);
        if (!e) return;
        e.style.display = show ? 'block' : 'none';
      }
      function validateRequired(node, errId){ const ok = !!(node && node.value && node.value.trim().length); showError(errId, !ok); return ok; }
      function validateStartsWithWho(node, errId){ const v=(node.value||'').trim().toLowerCase(); const ok=v.length>0 && v.startsWith('who'); showError(errId,!ok); return ok; }
      function validateDate(node, errId){ const v=(node.value||'').trim(); const ok=reDate.test(v); showError(errId,!ok); return ok; }
      function validateNumber(node, errId){ const v=(node.value||'').trim(); const ok=reMoneyNum.test(v); showError(errId,!ok); return ok; }
      function validateHasDollar(node, errId){ const v=(node.value||'').trim().toLowerCase(); const ok = v.includes('$'); showError(errId, !ok); return ok; }
      function validateHasDollarOrNA(node, errId){ const v=(node.value||'').trim().toLowerCase(); const ok = v==='n/a' || v.includes('$'); showError(errId, !ok); return ok; }
      function getMultiSelectValues(msEl){
        return Array.from(msEl?.selectedOptions || []).map(o => o.value);
      }
      function validateMultiRequired(msEl, errId){
        const ok = getMultiSelectValues(msEl).length > 0;
        showError(errId, !ok);
        return ok;
      }
      
      // --- Global error helpers (ADD THESE HERE) ---
function showGlobalError(msg){
  if (!formErr) return;
  formErr.classList.remove('hidden');
  if (msg) formErr.querySelector('.support-msg').textContent = msg;
}
function hideGlobalError(){
  if (!formErr) return;
  formErr.classList.add('hidden');
}
function scrollToFirstError(){
  const firstErr = Array.from(document.querySelectorAll('.error'))
    .find(e => e.style.display === 'block');
  if (firstErr){
    const container = firstErr.parentElement;
    const focusable = container && container.querySelector('input, select, textarea');
    if (focusable && typeof focusable.focus === 'function') focusable.focus();
    firstErr.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}

      // Visibility
      function updateVisibility(){
  // audience blocks
  consumerBlock.classList.toggle('hidden', audience.value!=='Consumer');
  dasherBlock.classList.toggle('hidden', audience.value!=='Dasher');
  merchantBlock.classList.toggle('hidden', audience.value!=='B2B');

  // ----- Consumer -----
  if (audience.value==='Consumer'){
    const ch = channel.value;
    const isEP_any = ch==='Email' || ch==='Push Notification' || ch==='Paid Media';
    const isEmailOrPush = ch==='Email' || ch==='Push Notification';
    c_ctaHint.classList.toggle('hidden', channel.value !== 'Paid Media');

    epBlock.classList.toggle('hidden', !isEP_any);
    unsupportedMsg.classList.toggle('hidden', isEP_any || !ch);

    const isPaid = ch==='Paid Media';
    paidBlock.classList.toggle('hidden', !isPaid);

    const hasPlatform = getMultiSelectValues(adPlatforms).length > 0;
    adTypeWrap.classList.toggle('hidden', !hasPlatform);
    videoQWrap.classList.toggle('hidden', !(adType.value === 'Video' || adType.value === 'Static and Video'));

    // Secondary allowed only for Email/Push
    c_secondaryFS.classList.toggle('hidden', !isEmailOrPush);
    if (!isEmailOrPush){
      hasSecondary.value = 'No';
      secondaryBlock.classList.add('hidden');
    }
  } else {
    unsupportedMsg.classList.add('hidden');
    epBlock.classList.add('hidden');
    paidBlock.classList.add('hidden');
    c_secondaryFS.classList.add('hidden');
  }

  // ----- Dasher -----
if (audience.value === 'Dasher') {
  const ch = d_channel.value;
  const isEmailOrPush = ch === 'Email' || ch === 'Push Notification';
  const isPaid = ch === 'Paid Media';
  const isUnsupported = ch === 'Long-form Content' || ch === 'In-app Merchandising';

  // Unsupported notice
  d_unsupportedMsg.classList.toggle('hidden', !isUnsupported);

  // CTA hint only for Paid Media
  d_ctaHint.classList.toggle('hidden', d_channel.value !== 'Paid Media');

  // Common rows
  const dSegmentRow     = d_segment.parentElement.parentElement;
  const dBehaviorRow    = d_behavior.parentElement.parentElement;
  const dSubmarketsRow  = d_submarkets.parentElement.parentElement;
  const dUsecaseRow     = d_usecase.parentElement.parentElement;
  const dActionRow      = d_action.parentElement.parentElement;
  const dTakeawayRow    = d_takeaway.parentElement.parentElement;
  const dFeatureRow     = d_feature.parentElement.parentElement;
  const dCtaRow         = d_cta.parentElement.parentElement;

  // Promotion fieldset (whole block) + inner block
  const dPromoFS = d_hasPromo.closest('fieldset'); // wraps the whole Promotion section

  if (isUnsupported) {
    // Hide EVERYTHING except the unsupported note
    d_paidBlock.classList.add('hidden');
    d_adTypeWrap.classList.add('hidden');
    d_videoQWrap.classList.add('hidden');
    d_secondaryFS.classList.add('hidden');

    [dSegmentRow, dBehaviorRow, dSubmarketsRow, dUsecaseRow, dActionRow, dTakeawayRow, dFeatureRow, dCtaRow]
      .forEach(r => r && r.classList.add('hidden'));

    // Hide Promotion section and reset it so nothing leaks into validation
    if (dPromoFS) dPromoFS.classList.add('hidden');
    d_hasPromo.value = 'No';
    d_promoBlock.classList.add('hidden');
  } else {
    // Normal Dasher flow
    [dSegmentRow, dBehaviorRow, dSubmarketsRow, dUsecaseRow, dActionRow, dTakeawayRow, dFeatureRow, dCtaRow]
      .forEach(r => r && r.classList.remove('hidden'));

    // Paid Media visibility
    d_paidBlock.classList.toggle('hidden', !isPaid);
    const hasPlatform = getMultiSelectValues(d_adPlatforms).length > 0;
    d_adTypeWrap.classList.toggle('hidden', !hasPlatform || !isPaid);
    d_videoQWrap.classList.toggle(
      'hidden',
      !isPaid || !(d_adType.value === 'Video' || d_adType.value === 'Static and Video')
    );

    // Secondary only for Email/Push
    d_secondaryFS.classList.toggle('hidden', !isEmailOrPush);
    if (!isEmailOrPush) {
      d_hasSecondary.value = 'No';
      d_secondaryBlock.classList.add('hidden');
    }

    // Promotion section visible in supported channels; inner block follows Yes/No
    if (dPromoFS) dPromoFS.classList.remove('hidden');
    d_promoBlock.classList.toggle('hidden', d_hasPromo.value !== 'Yes');
  }
} else {
  d_secondaryFS.classList.add('hidden');
  d_unsupportedMsg.classList.add('hidden');
}


  // ----- Merchant -----
if (audience.value === 'B2B') {
  const ch = m_channel.value;
  const isEmailOrPush = ch === 'Email' || ch === 'Push Notification';
  const isPaid = ch === 'Paid Media';
  const isLongForm = ch === 'Long-form Content';
  const isPortal = ch === 'Merchant Portal Feed Card' || ch === 'Portal Feed Card';

  // Unsupported note for Portal Feed Card
  m_unsupportedMsg.classList.toggle('hidden', !isPortal);

  // Hide/show the CTA hint only for Paid Media
  m_ctaHint.classList.toggle('hidden', m_channel.value !== 'Paid Media');

  // Get common rows
  const mBehaviorRow = m_behavior.parentElement.parentElement;
  const mSegmentRow = m_segment.parentElement.parentElement;
  const mUsecaseRow = m_usecase.parentElement.parentElement;
  const mActionRow = m_action.parentElement.parentElement;
  const mTakeawayRow = m_takeaway.parentElement.parentElement;
  const mFeatureRow = m_feature.parentElement.parentElement;
  const mCtaRow = m_cta.parentElement.parentElement;

  if (isPortal) {
    // Hide all questions if Portal Feed Card
    m_longform.classList.add('hidden');
    m_paidBlock.classList.add('hidden');
    m_adTypeWrap.classList.add('hidden');
    m_videoQWrap.classList.add('hidden');
    m_secondaryFS.classList.add('hidden');

    [mSegmentRow, mBehaviorRow, mUsecaseRow, mActionRow, mTakeawayRow, mFeatureRow, mCtaRow]
      .forEach(r => r && r.classList.add('hidden'));
  } else {
    // Normal Merchant flow
    [mSegmentRow, mUsecaseRow, mActionRow, mTakeawayRow, mFeatureRow, mCtaRow]
      .forEach(r => r && r.classList.remove('hidden'));

    // Long-form visibility
    m_longform.classList.toggle('hidden', !isLongForm);

    // Hide "behavior" only for long-form
    if (mBehaviorRow) {
      mBehaviorRow.classList.toggle('hidden', isLongForm);
    }

    // Paid visibility
    m_paidBlock.classList.toggle('hidden', !isPaid);
    const hasPlatform = getMultiSelectValues(m_adPlatforms).length > 0;
    m_adTypeWrap.classList.toggle('hidden', !hasPlatform || !isPaid);
    m_videoQWrap.classList.toggle(
      'hidden',
      !isPaid || !(m_adType.value === 'Video' || m_adType.value === 'Static and Video')
    );

    // Secondary allowed only for Email/Push
    m_secondaryFS.classList.toggle('hidden', !isEmailOrPush);
    if (!isEmailOrPush) {
      m_hasSecondary.value = 'No';
      m_secondaryBlock.classList.add('hidden');
    }

    // Long-form subtype toggles
    const lt = (m_longType?.value || '').toLowerCase();
    const isSuccess = lt === 'success story / case study';
    const isSeo = lt === 'seo landing page';
    m_successFields.classList.toggle('hidden', !(isLongForm && isSuccess));
    m_seoFields.classList.toggle('hidden', !(isLongForm && isSeo));
  }
} else {
  m_secondaryFS.classList.add('hidden');
  m_unsupportedMsg.classList.add('hidden');
}







  // ----- Existing promo toggles -----
  promoBlock.classList.toggle('hidden', hasPromo.value!=='Yes');
  d_promoBlock.classList.toggle('hidden', d_hasPromo.value!=='Yes');
  d_streaksBlock.classList.toggle('hidden', d_promoType.value!=='streaks');
  d_otherWrap.classList.toggle('hidden', d_promoType.value!=='other');

  // Inner secondary blocks tied to their toggles
  secondaryBlock.classList.toggle('hidden', hasSecondary.value!=='Yes');
  d_secondaryBlock.classList.toggle('hidden', d_hasSecondary.value!=='Yes');
  m_secondaryBlock.classList.toggle('hidden', m_hasSecondary.value!=='Yes');
}


      // Generate
      function generateConsumer(){
  let valid = true;

  valid &&= validateRequired(channel, 'channelErr');
  const ch = channel.value;
  const isEP = ch==='Email' || ch==='Push Notification' || ch==='Paid Media';

  if (isEP){
    valid &&= validateRequired(segment,'segmentErr');
    valid &&= validateStartsWithWho(behavior,'behaviorErr');
    valid &&= validateRequired(submarkets,'submarketsErr');
    valid &&= validateRequired(usecase,'usecaseErr');
    valid &&= validateRequired(action,'actionErr');
    valid &&= validateRequired(takeaway,'takeawayErr');

    if (ch==='Paid Media'){
      valid &&= validateMultiRequired(adPlatforms, 'adPlatformsErr');
      if (getMultiSelectValues(adPlatforms).length > 0){
        valid &&= validateRequired(adType, 'adTypeErr');
      }
    }

    if (hasPromo.value==='Yes'){
      valid &&= validateRequired(promoType,'promoTypeErr');
      valid &&= validateHasDollarOrPercent(discount,'discountErr');
      valid &&= validateDate(startDate,'startErr');
      valid &&= validateDate(endDate,'endErr');
      valid &&= validateNumber(minSubtotal,'minErr');
      valid &&= validateNumber(maxDiscount,'maxErr');
    }
  }

  if (!valid) return '';

  const aud = 'Consumer';
  const seg = segment.value || '';
  const beh = (behavior.value||'').trim();
  const loc = (submarkets.value||'').trim();
  const uc  = usecase.value || '';
  const callToAction = cta.value || 'N/A';
  const actVal = (action.value||'').trim() || 'N/A';
  const takeVal = (takeaway.value||'').trim() || 'N/A';
  const feat = (feature?.value || '').trim() || 'N/A';

  // NEW: LOB handling
  const lobVal = (lob?.value || '').trim();
  const lobValid = !!lobVal && lobVal.toLowerCase() !== 'n/a';

  let txt = '';

  if (ch === 'Paid Media') {
    const duration = (adType.value === 'Video' || adType.value === 'Static and Video') ? (videoLength.value || '') + ' ' : '';
    const lobSuffix = lobValid ? ` and it has focused on ${lobVal}` : '';
    txt = `I need a ${duration}${adType.value} ${ch} ad for our DoorDash ${aud} team targeting ${seg} ${beh} in ${loc}${lobSuffix}. Use Case: ${uc}.
The main action we want the consumer to take: ${actVal}
The most important takeaway for consumer: ${takeVal}
Feature / service details: ${feat}
CTA: ${callToAction}.`;
  } else {
    // If LOB present, use the exact requested sentence
    const opener = lobValid
      ? `I need an ${ch} for our DoorDash ${aud} team targeting ${seg} ${beh} in ${loc} and it has focused on ${lobVal}.`
      : `I need a(n) ${ch} for our DoorDash ${aud} team targeting ${seg} ${beh} in ${loc}.`;
    txt = `${opener} Use Case: ${uc}.
The main action we want the consumer to take: ${actVal}
The most important takeaway for Consumer: ${takeVal}
Feature / service details: ${feat}
CTA: ${callToAction}.`;
  }

  if (ch==='Paid Media'){
    const platforms = getMultiSelectValues(adPlatforms);
    if (platforms.length){
      txt += `\nPlatforms: ${platforms.join(', ')}.`;
    }
  }

  if (hasPromo.value==='Yes'){
    const pType = promoType.value;
    const disc = (discount.value||'').trim();
    const start = (startDate.value||'').trim();
    const end = (endDate.value||'').trim();
    const min = Number((minSubtotal.value||'0').trim());
    const max = Number((maxDiscount.value||'0').trim());
    const pickOnly = pickupOnly.value==='Yes';
    const code = (promoCode.value||'').trim();
    const dpOnly = dashpassOnly.value==='Yes';

    txt += `\nThis campaign include a [${pType} promo]`;

    const money = (n)=> isNaN(n)?'0':n.toString();
    const minTxt = `$${money(min)}`;
    const maxTxt = `$${money(max)}`;

    if (pType==='Save Up To $X'){
      txt += `\nOffer: ${disc} off their next order of ${minTxt} up to ${maxTxt} – valid between ${start} and ${end}.`;
    } else if (pType==='X Off Your Order'){
      txt += `\nOffer: ${disc} off their next order of ${minTxt}– valid between ${start} and ${end}.`;
    } else if (pType==='$0 Delivery Fee'){
      txt += `\nOffer: $0 Delivery Fee off their next order of ${minTxt} – valid between ${start} and ${end}.`;
    } else if (pType==='$ X off Delivery Fee'){
      txt += `\nOffer: ${disc} off your Delivery Fee on their next order of ${minTxt} – valid between ${start} and ${end}.`;
    } else {
      txt += `\nOffer: ${disc} – valid between ${start} and ${end}.`;
    }

    if (pickOnly) txt += ' Pick up orders only.';
    if (dpOnly) txt += ' DashPass Members only.';
    if (code && code.toLowerCase()!=='n/a') txt += ` ${code}.`;
  }

  if (hasSecondary.value==='Yes'){
    const sObj = (secondaryObjective.value||'N/A').trim();
    const sLOB = secondaryLOB.value || 'N/A';
    const sCTA = secondaryCTA.value || 'N/A';
    txt += `\nAlso include a secondary message where the objective is ${sObj} focused on ${sLOB} and cta should be ${sCTA}`;
  }

  return txt.trim();

  function validateHasDollarOrPercent(node, errId){
    const v=(node.value||'').trim();
    const ok = /[$%]/.test(v) && v.length>0;
    showError(errId,!ok);
    return ok;
  }
}


      function generateDasher(){
        let valid = true;
        const isEP = d_channel.value === 'Email' || d_channel.value === 'Push Notification';
        if (isEP) {
          valid &&= validateRequired(d_segment,'d_segmentErr');
          valid &&= validateStartsWithWho(d_behavior,'d_behaviorErr');
        }

        valid &&= validateRequired(d_usecase,'d_usecaseErr');
        valid &&= validateRequired(d_action,'d_actionErr');
        valid &&= validateRequired(d_takeaway,'d_takeawayErr');

        if (d_channel.value==='Paid Media'){
          valid &&= validateMultiRequired(d_adPlatforms, 'd_adPlatformsErr');
          if (getMultiSelectValues(d_adPlatforms).length > 0){
            valid &&= validateRequired(d_adType, 'd_adTypeErr');
          }
        }

        if (d_hasPromo.value==='Yes'){
          valid &&= validateRequired(d_promoType,'d_promoTypeErr');
          valid &&= validateDate(d_startDate,'d_startErr');
          valid &&= validateDate(d_endDate,'d_endErr');
          valid &&= validateNumber(d_minDeliveries,'d_minErr');
          valid &&= validateHasDollar(d_stdPayout,'d_stdErr');
          valid &&= validateHasDollarOrNA(d_maxPayout,'d_maxErr');

          if (d_promoType.value==='streaks'){
            valid &&= validateNumber(d_consecDays,'d_daysErr');
            valid &&= validateHasDollar(d_additionalPayout,'d_additionalErr');
          }
        }

        if (!valid) return '';

        const aud = 'Dasher';
        const ch = d_channel.value || '';
        const seg = d_segment.value || '';
        const beh = (d_behavior.value||'').trim();
        const loc = (d_submarkets.value||'').trim();
        const uc  = d_usecase.value || '';
        const callToAction = d_cta.value || 'N/A';
        const actVal = (d_action.value||'').trim() || 'N/A';
        const takeVal = (d_takeaway.value||'').trim() || 'N/A';

        let txt = '';
        if (ch === 'Paid Media') {
          const duration = (d_adType.value === 'Video' || d_adType.value === 'Static and Video') ? (d_videoLength.value || '') + ' ' : '';
          txt = `I need a ${duration}${d_adType.value} ${ch} ad for our DoorDash ${aud} team targeting ${seg} ${beh} in ${loc}. Use Case: ${uc}.
The main action we want the Dasher to take: ${actVal}
The most important takeaway for Dasher: ${takeVal}
CTA: ${callToAction}.`;
        } else {
          txt = `I need an ${ch} for our DoorDash ${aud} team targeting ${seg} ${beh} in ${loc}. 
Use Case: ${uc}.
The main action we want the Dasher to take: ${actVal}
The most important takeaway for Dasher: ${takeVal}
CTA: ${callToAction}.`;
        }

        if (ch === 'Paid Media') {
          const platforms = getMultiSelectValues(d_adPlatforms);
          if (platforms.length) {
            txt += `\nPlatforms: ${platforms.join(', ')}.`;
          }
          
        }

        if (d_hasPromo.value==='Yes'){
          const pType = d_promoType.value;
          const start = (d_startDate.value||'').trim();
          const end = (d_endDate.value||'').trim();
          const minDel = (d_minDeliveries.value||'0').trim();
          const stdPay = (d_stdPayout.value||'').trim();
          const maxPay = (d_maxPayout.value||'').trim();

          if (pType==='Complete x dashers, receive $x'){
            txt += `\nThis campaign includes a promotion:\nOffer: Get ${stdPay} when you complete ${minDel} dashes between ${start} and ${end}`;
          } else if (pType==='streaks'){
            const days = (d_consecDays.value||'').trim();
            const addPay = (d_additionalPayout.value||'').trim();
            txt += `\nThis campaign includes a promotion:\nOffer: Get ${stdPay} when you complete ${minDel} dashes for ${days} days plus an additional ${addPay} (max ${maxPay}) between ${start} and ${end}`;
          } else {
            const other = (d_otherPromo.value||'').trim();
            txt += `\nThis campaign includes a promotion:\nOffer: ${other || stdPay} between ${start} and ${end}`;
          }
        }

        // Append secondary module details (Dasher)
        if (d_hasSecondary.value==='Yes'){
          const sObj = (d_secondaryObjective.value||'N/A').trim();
          const sLOB = d_secondaryLOB.value || 'N/A';
          const sCTA = d_secondaryCTA.value || 'N/A';
          txt += `\nAlso include a secondary message where the objective is ${sObj}, focused on ${sLOB}, with CTA ${sCTA}.`;
        }

        return txt.trim();
      }

      function generateMerchant(){
  let valid = true;

  valid &&= validateRequired(m_channel,'m_channelErr');
  const ch = m_channel.value || '';

  // Always need segment/usecase/action/takeaway
  valid &&= validateRequired(m_segment,'m_segmentErr');

  // Behavior is required for non–long-form only
  if (ch !== 'Long-form Content'){
    valid &&= validateStartsWithWho(m_behavior,'m_behaviorErr');
  }

  valid &&= validateRequired(m_usecase,'m_usecaseErr');
  valid &&= validateRequired(m_action,'m_actionErr');
  valid &&= validateRequired(m_takeaway,'m_takeawayErr');

  // Paid Media validations
  if (ch === 'Paid Media'){
    valid &&= validateMultiRequired(m_adPlatforms, 'm_adPlatformsErr');
    if (getMultiSelectValues(m_adPlatforms).length > 0){
      valid &&= validateRequired(m_adType, 'm_adTypeErr');
    }
  }

  // If Long-Form, validate subtype & subtype-specific fields
  if (ch === 'Long-form Content'){
    valid &&= validateRequired(m_longType, 'm_longTypeErr');
    const lt = (m_longType.value || '').toLowerCase();
    if (lt === 'success story / case study'){
      valid &&= validateRequired(m_successMerchant, 'm_successMerchantErr');
      valid &&= validateRequired(m_successQuotes, 'm_successQuotesErr');
      valid &&= validateRequired(m_successResults, 'm_successResultsErr');
    }
    if (lt === 'seo landing page'){
      valid &&= validateRequired(m_seoKeywords, 'm_seoKeywordsErr');
    }
  }

  if (!valid) return '';

  // ----- Common fields (define BEFORE any output building) -----
  const seg = m_segment.value || '';
  const uc  = m_usecase.value || '';
  const actVal = (m_action.value||'').trim() || 'N/A';
  const takeVal = (m_takeaway.value||'').trim() || 'N/A';
  const callToAction = m_cta.value || 'N/A';
  const productAns = (m_feature?.value || '').trim() || 'N/A';

  // ----- Long-Form OUTPUT (single, final version) -----
  if (ch === 'Long-form Content'){
    const longType = m_longType.value || 'Long-form Content';
    const lt = (m_longType.value || '').toLowerCase();
    const article = /^[aeiou]/i.test(longType) ? 'an' : 'a';

    let txt = `I need ${article} ${longType} for our DoorDash Merchant Content team targeting ${seg}. Use Case: ${uc}. The action we want the Merchant to take: ${actVal}. The most important takeaway for the Merchant: ${takeVal}. Highlight the following product/service: ${productAns}. CTA: ${callToAction}.`;

    if (lt === 'success story / case study'){
      const merchantDetails = (m_successMerchant?.value || '').trim();
      const quotes = (m_successQuotes?.value || '').trim();
      const results = (m_successResults?.value || '').trim();
      txt += `\nIn this article highlight these details about the merchant: ${merchantDetails}.`
           + ` \nPlease use these quotes: ${quotes}.`
           + ` \nAlso highlight these key results: ${results}.`;
    }

    if (lt === 'seo landing page'){
      const keywords = (m_seoKeywords?.value || '').trim();
      if (keywords) txt += `\nSEO keywords to target: ${keywords}`;
    }

    return txt.trim();
  }

  // ----- Default (non–Paid Media) -----
  let txt = `I need a ${ch} for our DoorDash Merchant team targeting ${seg} ${(m_behavior.value||'').trim()}. 
Use Case: ${uc}.
The main action we want the Merchant to take: ${actVal}
The most important takeaway for Merchant: ${takeVal}
Product/Service overview: ${productAns}
CTA: ${callToAction}.`;

  // ----- Paid Media override -----
  if (ch === 'Paid Media'){
    const duration = (m_adType.value === 'Video' || m_adType.value === 'Static and Video')
      ? (m_videoLength?.value || '') + ' '
      : '';
    txt = `I need a ${duration}${m_adType.value} ${ch} ad for our DoorDash Merchant team targeting ${seg} ${(m_behavior.value||'').trim()}. 
Use Case: ${uc}.
The main action we want the Merchant to take: ${actVal}
The most important takeaway for Merchant: ${takeVal}
Product/Service overview: ${productAns}
CTA: ${callToAction}.`;
  }
  
  if (ch === 'Paid Media') {
          const platforms = getMultiSelectValues(m_adPlatforms);
          if (platforms.length) {
            txt += `\nPlatforms: ${platforms.join(', ')}.`;
          }
          
        }

  // Secondary Merchant
  if (m_hasSecondary.value === 'Yes') {
    const sObj = (m_secondaryObjective.value || 'N/A').trim();
    const sCTA2 = m_secondaryCTA.value || 'N/A';
    txt += `\nAlso include a secondary message where the objective is ${sObj} with CTA ${sCTA2}.`;
  }

  return txt.trim();
}



      function gatherAndGenerate(){
  hideGlobalError();
  output.textContent = '';

  let valid = true;
  valid &&= validateRequired(audience,'audienceErr');

  if (!valid){
    showGlobalError();
    scrollToFirstError();
    return;
  }

  let text = '';
  if (audience.value === 'Consumer'){
    text = generateConsumer();
  } else if (audience.value === 'Dasher'){
    text = generateDasher();
  } else if (audience.value === 'B2B'){
    text = generateMerchant();
  }

  // If any audience-specific validation failed, their generator returns ''
  if (!text){
    showGlobalError();
    scrollToFirstError();
    return;
  }

  // Success
  hideGlobalError();
  output.textContent = text.trim();
  if (text) output.scrollIntoView({ behavior:'smooth', block:'center' });
}


      function validateHasDollarOrPercent(node, errId){
        const v=(node.value||'').trim();
        const ok = /[$%]/.test(v) && v.length>0;
        showError(errId,!ok);
        return ok;
      }

      // Events
      audience.addEventListener('change', updateVisibility);
      channel.addEventListener('change', updateVisibility);
      d_channel.addEventListener('change', updateVisibility);
      m_channel.addEventListener('change', updateVisibility);
      m_adPlatforms.addEventListener('change', updateVisibility);
      adType.addEventListener('change', updateVisibility);
      d_adType.addEventListener('change', updateVisibility);
      m_adType.addEventListener('change', updateVisibility);
      m_longType.addEventListener('change', updateVisibility);


      adPlatforms.addEventListener('change', updateVisibility);
      d_adPlatforms.addEventListener('change', updateVisibility);
      hasPromo.addEventListener('change', updateVisibility);
      hasSecondary.addEventListener('change', updateVisibility);
      d_hasPromo.addEventListener('change', updateVisibility);
      d_promoType.addEventListener('change', updateVisibility);
      d_hasSecondary.addEventListener('change', updateVisibility);
      m_hasSecondary.addEventListener('change', updateVisibility);

      generateBtn.addEventListener('click', gatherAndGenerate);
      copyBtn.addEventListener('click', async () => {
        const text = output.textContent.trim();
        if (!text) return;
        try{
          await navigator.clipboard.writeText(text);
          copyBtn.textContent = 'Copied!';
          copyBtn.style.borderColor = 'var(--ok)';
          setTimeout(()=>{copyBtn.textContent='Copy Text';copyBtn.style.borderColor='var(--border)';},1200);
        }catch(e){
          const ta=document.createElement('textarea');
          ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        }
      });
      resetBtn.addEventListener('click', ()=> setTimeout(updateVisibility, 0));

      // init
      updateVisibility();
    </script>
  </div>
</body>
</html>
